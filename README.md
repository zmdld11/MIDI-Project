# MIDI 简谱播放器项目

这是一个基于 Windows MIDI API 的 C++ 简谱播放器项目，能够从文本文件读取简谱并播放音乐，支持左右手谱分离播放、简谱预览等功能。

## 项目概述

该项目包含以下主要功能：
- 从文本文件读取简谱（支持标准简谱格式）
- 播放音乐（支持左右手分离播放）
- 简谱预览与格式化显示
- 逐小节播放控制
- 音量控制和节拍速度调整

## 文件结构

```
project/
├── main_ver4.cpp            // 主程序入口
├── MIDIexample_ver4.cpp     // MIDI播放核心实现
├── MIDIexample_ver4.h       // 头文件
├── readme.md                // 项目文档
├── music/                   // 存放简谱文件
│   └── [曲谱名称].txt
└── 点歌.txt                 // 曲目列表文件
```

## 编译与运行

### 编译要求
- Windows 系统
- C++11 兼容编译器
- 链接 `winmm` 库

### 编译命令
```bash
g++ -std=c++11 main_ver4.cpp MIDIexample_ver4.cpp -o midi_player -lwinmm
```

### 运行程序
```bash
cmake-build-release\ver4.exe
```

## 简谱格式规范

在 `music/` 目录下的文本文件中使用以下格式编写简谱：

```plaintext
[节拍速度] [默认音量]
[右手谱行1]
[左手谱行1]
[右手谱行2]
[左手谱行2]
...
```

### 音符符号说明

| 字符  | 说明                     | 示例            |
|-------|--------------------------|-----------------|
| 1-7   | 音符 (do, re, mi...)     | `1 2 3`         |
| 0     | 休止符                   | `0`             |
| ,     | 低音号 (每符号降低八度)  | `1,` → C3       |
| ^     | 高音号 (每符号升高八度)  | `1^` → C5       |
| #     | 升半音                   | `4#` → F#       |
| -     | 延音 (延长时值)          | `5-` → 延长一拍 |
| _     | 分音 (减半时值)          | `5_` → 半拍     |
| .     | 附点 (增加50%时值)       | `5.` → 1.5拍    |
| [ ]   | 和弦                     | `[1 3 5]`       |
| { }   | 和弦 (另一种格式)        | `{1 3 5}`       |
| \|    | 小节分隔符               | `1 2 \| 3 4`    |

### 音量控制符号

| 符号 | 说明         | 效果       |
|------|--------------|------------|
| p    | 弱           | 音量 -10   |
| pp   | 很弱         | 音量 -20   |
| f    | 强           | 音量 +10   |
| ff   | 很强         | 音量 +20   |
| mf   | 中强         | 音量 +5    |
| mp   | 中弱         | 音量 -5    |

## 使用方法

1. **准备曲谱文件**：
    - 在 `music/` 目录下创建简谱文本文件
    - 在 `点歌.txt` 文件中添加曲目名称（不带扩展名）

2. **运行程序**：
    - 程序启动后会询问是否预览简谱
    - 输入 `Y` 预览，`N` 直接播放

3. **播放控制**：
   ```
   1 --- 右手播放
   2 --- 左手播放
   3 --- 双手同时播放
   0 --- 退出程序
   ```

## 程序功能示例

### 简谱预览
```plaintext
***—————————————————简谱预览—————————————————***

===== 简谱 =====
速度: 500 毫秒/拍
----------------

[段落 1]
*小节 1*
R: C4 D4 E4 F4
L: C3 E3 G3

*小节 2*
R: G4 A4 B4 C5
L: F3 A3 C4

===== 结束 =====
```

### 播放示例
```plaintext
		正在为您播放：小星星(钢琴伴奏)

[段落 1 - 小节 1]
R: C4 C4 G4 G4
L: C3 E3 G3

[段落 1 - 小节 2]
R: A4 A4 G4
L: F3 A3 C4

总时长: 4.32秒
```

## 项目类结构

### `MusicPlayer` 类
- 核心音乐播放功能
- 支持左右手分离播放
- 音量控制
- 节拍速度调整

### `MusicList` 类
- 简谱存储和管理
- 从文件读取简谱
- 设置默认音量和节拍速度

### `SimplifiedScorePrinter` 类
- 简谱格式化输出
- 音符到音名转换 (C4, D#5等)
- 小节分隔和显示
